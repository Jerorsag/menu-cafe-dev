---
import Layout from '../layouts/Layout.astro';
import MenuHeader from '../components/menu/MenuHeader.astro';
import MenuTabs from '../components/menu/MenuTabs.astro';
import MenuSidebar from '../components/menu/MenuSidebar.astro';
import ProductGrid from '../components/menu/ProductGrid.astro';
import { getMenu } from '../lib/api';

const { title, subtitle, products } = await getMenu();
---
<Layout title="MenÃº">
  <MenuHeader />

  <div class="container-mocawa py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <aside class="lg:w-80 flex-shrink-0">
        <MenuSidebar />
      </aside>

      <section class="flex-1 min-w-0">
        <MenuTabs />
        <ProductGrid products={products} />
      </section>
    </div>
  </div>
</Layout>

<script is:inline>
  // Tu estado global actual
  window.menuState = {
    activeCategory: 'panaderia',
    activeFilters: [],
    cartItems: JSON.parse(localStorage.getItem('mocawa-cart') || '[]'),
    sidebarOpen: false
  };
  function updateMenuState(newState) {
    window.menuState = { ...window.menuState, ...newState };
    window.dispatchEvent(new CustomEvent('menu-state-changed', { detail: window.menuState }));
  }
  function toggleSidebar() { updateMenuState({ sidebarOpen: !window.menuState.sidebarOpen }); }
  window.updateMenuState = updateMenuState;
  window.toggleSidebar = toggleSidebar;
</script>