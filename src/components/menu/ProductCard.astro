---
import type { Product } from '../../lib/types';
import { Star } from '@lucide/astro';

interface Props { product: Product }
const { product }: Props = Astro.props;

const price = new Intl.NumberFormat('es-CO', {
  style: 'currency', currency: 'COP', maximumFractionDigits: 0
}).format(Number(product.price || 0));

const catLabel =
  (product.catSlug || '')
    .replace(/-/g, ' ')
    .replace(/\b\w/g, (m) => m.toUpperCase()) || 'General';
---

<article
  class="group relative overflow-hidden rounded-2xl bg-white border border-card shadow-sm transition-all duration-500 hover:shadow-lg"
>
  {/* Sutil tira superior con acento (no invade todo de verde) */}
  <div class="absolute inset-x-0 top-0 h-1 bg-[var(--accent-color)]/70"></div>

  {/* Badge Popular (pequeño, sin saturar) */}
  {product.isPopular && (
    <div class="absolute top-4 left-4 z-10">
      <span class="inline-flex items-center rounded-full bg-[var(--accent-color)]/90 text-white px-2.5 py-1 text-[11px] font-medium shadow">
        <Star class="w-3 h-3 mr-1" /> Popular
      </span>
    </div>
  )}

  {/* Imagen */}
  <div class="relative overflow-hidden aspect-[4/3] bg-gradient-to-br from-stone-50 to-stone-100">
    {product.imageUrl ? (
      <img
        src={product.imageUrl}
        alt={product.imageAlt || product.title || 'Producto'}
        loading="lazy"
        class="w-full h-full object-cover object-center transition-transform duration-700 ease-in-out group-hover:scale-105"
      />
    ) : (
      <div class="grid place-items-center w-full h-full text-stone-400 text-sm">Sin imagen</div>
    )}
    <div class="absolute inset-0 bg-gradient-to-t from-black/15 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
  </div>

  {/* Contenido */}
  <div class="p-6">
    <div class="mb-3">
      <h4 class="text-lg font-bold text-[var(--sage-darker)] mb-2 group-hover:text-[var(--sage-dark)] transition-colors duration-300">
        {product.title}
      </h4>
      {product.description && (
        <p class="text-sm leading-relaxed text-[var(--sage-darker)]">
          {product.description}
        </p>
      )}
    </div>

    {/* Precio + CTA visual (neutral, con acento sutil al hover) */}
    <div class="mt-4 flex items-center justify-between">
      <p class="text-xl font-semibold text-[var(--sage-darker)]">{price}</p>

      <a
        href="#"
        role="button"
        aria-disabled="true"
        title="Pedido próximamente"
        class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium
               bg-[var(--sage-darker)] border border-card text-header
               hover:border-[var(--accent-color)]/60 hover:text-[var(--sage-dark)]
               transition-colors duration-300 cursor-pointer"
      >
        Pedir
      </a>
    </div>
  </div>

  {/* Borde reactivo en hover usando el acento */}
  <div class="pointer-events-none absolute inset-0 rounded-2xl border-2 border-transparent group-hover:border-[var(--accent-color)]/30 transition-colors duration-300"></div>
</article>